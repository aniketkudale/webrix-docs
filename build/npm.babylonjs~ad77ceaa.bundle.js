(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{fqU1:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var s=i("mrSG"),r=i("ADVu"),n=i("/SR9"),a=i("llUH"),o=i("SYzJ"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._needProjectionMatrixCompute=!0,t}return Object(s.c)(t,e),t.prototype._setPosition=function(e){this._position=e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!0,configurable:!0}),t.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=n.e.Zero()),n.e.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=n.e.Zero()),n.e.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(e){return this.direction=n.e.Normalize(e.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var e=n.e.Cross(this.direction,o.a.Y),t=n.e.Cross(e,this.direction);return n.e.RotationFromAxis(e,t,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=n.e.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=n.a.Identity()),n.a.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},t.prototype.getDepthMinZ=function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ},t.prototype.getDepthMaxZ=function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ},t.prototype.setShadowProjectionMatrix=function(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this},Object(s.b)([Object(r.l)()],t.prototype,"position",null),Object(s.b)([Object(r.l)()],t.prototype,"direction",null),Object(s.b)([Object(r.c)()],t.prototype,"shadowMinZ",null),Object(s.b)([Object(r.c)()],t.prototype,"shadowMaxZ",null),t}(a.a)},itUE:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var s=i("mrSG"),r=i("/SR9"),n=i("Xeau"),a=i("y4Ty"),o=i("llUH"),h=i("/eyM"),u=i("aCSs"),c=i("srWW"),d=i("OJ6t"),l=i("AGTA"),p=(i("IS0N"),i("QcF5"),i("8uwT"),i("ps+7")),f=i("n5HA"),_=i("UpSL"),m=i("F24J"),g=function(){function e(t,i,s){this.onBeforeShadowMapRenderObservable=new p.a,this.onAfterShadowMapRenderObservable=new p.a,this.onBeforeShadowMapRenderMeshObservable=new p.a,this.onAfterShadowMapRenderMeshObservable=new p.a,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=r.e.Zero(),this._viewMatrix=r.a.Zero(),this._projectionMatrix=r.a.Zero(),this._transformMatrix=r.a.Zero(),this._cachedPosition=new r.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new r.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=r.a.Identity(),this._mapSize=t,this._light=i,this._scene=i.getScene(),i._shadowGenerator=this,e._SceneComponentInitialization(this._scene);var n=this._scene.getEngine().getCaps();s?n.textureFloatRender&&n.textureFloatLinearFiltering?this._textureType=1:n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?this._textureType=2:this._textureType=0:n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?this._textureType=2:n.textureFloatRender&&n.textureFloatLinearFiltering?this._textureType=1:this._textureType=0,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalBias",{get:function(){return this._normalBias},set:function(e){this._normalBias=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurScale",{get:function(){return this._blurScale},set:function(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(e){this._depthScale=e},enumerable:!0,configurable:!0}),e.prototype._validateFilter=function(e){return e},Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(t){if(t=this._validateFilter(t),this._light.needCube()){if(t===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===e.FILTER_PCF||t===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==e.FILTER_PCF&&t!==e.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING},set:function(t){var i=this._validateFilter(e.FILTER_POISSONSAMPLING);(t||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useExponentialShadowMap",{get:function(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP},set:function(t){var i=this._validateFilter(e.FILTER_EXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(t){var i=this._validateFilter(e.FILTER_BLUREXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(t){var i=this._validateFilter(e.FILTER_CLOSEEXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(t){var i=this._validateFilter(e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===e.FILTER_PCF},set:function(t){var i=this._validateFilter(e.FILTER_PCF);(t||this.filter===e.FILTER_PCF)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(e){this._filteringQuality!==e&&(this._filteringQuality=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useContactHardeningShadow",{get:function(){return this.filter===e.FILTER_PCSS},set:function(t){var i=this._validateFilter(e.FILTER_PCSS);(t||this.filter===e.FILTER_PCSS)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(e){this._contactHardeningLightSizeUVRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"darkness",{get:function(){return this._darkness},set:function(e){this.setDarkness(e)},enumerable:!0,configurable:!0}),e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(e){return this._darkness=e>=1?1:e<=0?0:e,this},Object.defineProperty(e.prototype,"transparencyShadow",{get:function(){return this._transparencyShadow},set:function(e){this.setTransparencyShadow(e)},enumerable:!0,configurable:!0}),e.prototype.setTransparencyShadow=function(e){return this._transparencyShadow=e,this},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},e.prototype.getClassName=function(){return e.CLASSNAME},e.prototype.addShadowCaster=function(e,t){var i;return void 0===t&&(t=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(e),t&&(i=this._shadowMap.renderList).push.apply(i,e.getChildMeshes()),this):this},e.prototype.removeShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var i=this._shadowMap.renderList.indexOf(e);if(-1!==i&&this._shadowMap.renderList.splice(i,1),t)for(var s=0,r=e.getChildren();s<r.length;s++){var n=r[s];this.removeShadowCaster(n)}return this},e.prototype.getLight=function(){return this._light},e.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},e.prototype._createTargetRenderTexture=function(){this._scene.getEngine().webGLVersion>1?(this._shadowMap=new c.a(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(513,!0)):this._shadowMap=new c.a(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube())},e.prototype._initializeShadowMap=function(){var t=this;if(this._createTargetRenderTexture(),null!==this._shadowMap){this._shadowMap.wrapU=u.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=u.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(u.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this);var i=this._scene.getEngine();this._shadowMap.onBeforeRenderObservable.add((function(s){t._currentFaceIndex=s,t._filter===e.FILTER_PCF&&i.setColorWrite(!1)})),this._shadowMap.onAfterUnbindObservable.add((function(){if(t._filter===e.FILTER_PCF&&i.setColorWrite(!0),t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){var s=t.getShadowMapForRendering();s&&t._scene.postProcessManager.directRender(t._blurPostProcesses,s.getInternalTexture(),!0)}}));var s=new n.b(0,0,0,0),r=new n.b(1,1,1,1);this._shadowMap.onClearObservable.add((function(i){t._filter===e.FILTER_PCF?i.clear(r,!1,!0,!1):t.useExponentialShadowMap||t.useBlurExponentialShadowMap?i.clear(s,!0,!0,!1):i.clear(r,!0,!0,!1)})),this._shadowMap.onResizeObservable.add((function(e){t._storedUniqueId=t._shadowMap.uniqueId,t._mapSize=e.getRenderSize(),t._light._markMeshesAsLightDirty(),t.recreateShadowMap()}));for(var a=m.a.MIN_RENDERINGGROUPS;a<m.a.MAX_RENDERINGGROUPS;a++)this._shadowMap.setRenderingAutoClearDepthStencil(a,!1)}},e.prototype._initializeBlurRTTAndPostProcesses=function(){var e=this,t=this._scene.getEngine(),i=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new c.a(this._light.name+"_shadowMap2",i,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=u.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=u.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(u.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new l.a(this._light.name+"KernelBlurX",new r.d(1,0),this.blurKernel,1,null,u.a.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.width=i,this._kernelBlurXPostprocess.height=i,this._kernelBlurXPostprocess.onApplyObservable.add((function(t){t.setTexture("textureSampler",e._shadowMap)})),this._kernelBlurYPostprocess=new l.a(this._light.name+"KernelBlurY",new r.d(0,1),this.blurKernel,1,null,u.a.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,0===this._textureType&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new d.a(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,u.a.BILINEAR_SAMPLINGMODE,t,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add((function(t){t.setFloat2("screenSize",i,i),t.setTexture("textureSampler",e._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},e.prototype._renderForShadowMap=function(e,t,i,s){var r,n=this._scene.getEngine(),a=n.getColorWrite();if(s.length){for(n.setColorWrite(!1),r=0;r<s.length;r++)this._renderSubMeshForShadowMap(s.data[r]);n.setColorWrite(a)}for(r=0;r<e.length;r++)this._renderSubMeshForShadowMap(e.data[r]);for(r=0;r<t.length;r++)this._renderSubMeshForShadowMap(t.data[r]);if(this._transparencyShadow)for(r=0;r<i.length;r++)this._renderSubMeshForShadowMap(i.data[r])},e.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(e,t){},e.prototype._renderSubMeshForShadowMap=function(e){var t=this,i=e.getRenderingMesh(),s=this._scene,r=s.getEngine(),n=e.getMaterial();if(i._internalAbstractMeshDataInfo._isActiveIntermediate=!1,n&&0!==e.verticesCount){r.setState(n.backFaceCulling);var a=i._getInstancesRenderList(e._id);if(!a.mustReturn){var u=r.getCaps().instancedArrays&&null!==a.visibleInstances[e._id]&&void 0!==a.visibleInstances[e._id];if(this.isReady(e,u)){if(r.enableEffect(this._effect),i._bind(e,this._effect,n.fillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===o.a.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),s.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(s.activeCamera),this.getLight().getDepthMinZ(s.activeCamera)+this.getLight().getDepthMaxZ(s.activeCamera)),n&&n.needAlphaTesting()){var c=n.getAlphaTestTexture();c&&(this._effect.setTexture("diffuseSampler",c),this._effect.setMatrix("diffuseMatrix",c.getTextureMatrix()||this._defaultTextureMatrix))}if(i.useBones&&i.computeBonesUsingShaders&&i.skeleton){var d=i.skeleton;if(d.isUsingTextureForMatrices){var l=d.getTransformMatrixTexture(i);if(!l)return;this._effect.setTexture("boneSampler",l),this._effect.setFloat("boneTextureWidth",4*(d.bones.length+1))}else this._effect.setMatrices("mBones",d.getTransformMatrices(i))}h.a.BindMorphTargetParameters(i,this._effect),h.a.BindClipPlane(this._effect,s),this._bindCustomEffectForRenderSubMeshForShadowMap(e,this._effect),this.forceBackFacesOnly&&r.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(i),this.onBeforeShadowMapRenderObservable.notifyObservers(this._effect),i._processRendering(e,this._effect,n.fillMode,a,u,(function(e,i){return t._effect.setMatrix("world",i)})),this.forceBackFacesOnly&&r.setState(!0,0,!1,!1),this.onAfterShadowMapRenderObservable.notifyObservers(this._effect),this.onAfterShadowMapRenderMeshObservable.notifyObservers(i)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},e.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(u.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(u.a.BILINEAR_SAMPLINGMODE))},e.prototype.forceCompilation=function(e,t){var i=this,r=Object(s.a)({useInstances:!1},t),n=this.getShadowMap();if(n){var a=n.renderList;if(a){for(var o=new Array,h=0,u=a;h<u.length;h++){var c=u[h];o.push.apply(o,c.subMeshes)}if(0!==o.length){var d=0,l=function(){if(i._scene&&i._scene.getEngine()){for(;i.isReady(o[d],r.useInstances);)if(++d>=o.length)return void(e&&e(i));setTimeout(l,16)}};l()}else e&&e(this)}else e&&e(this)}else e&&e(this)},e.prototype.forceCompilationAsync=function(e){var t=this;return new Promise((function(i){t.forceCompilation((function(){i()}),e)}))},e.prototype._isReadyCustomDefines=function(e,t,i){},e.prototype.isReady=function(e,t){var i=[];0!==this._textureType&&i.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?i.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&i.push("#define DEPTHTEXTURE");var s=[a.b.PositionKind],r=e.getMesh(),n=e.getMaterial();if(this.normalBias&&r.isVerticesDataPresent(a.b.NormalKind)&&(s.push(a.b.NormalKind),i.push("#define NORMAL"),r.nonUniformScaling&&i.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===o.a.LIGHTTYPEID_DIRECTIONALLIGHT&&i.push("#define DIRECTIONINLIGHTDATA")),n&&n.needAlphaTesting()){var u=n.getAlphaTestTexture();u&&(i.push("#define ALPHATEST"),r.isVerticesDataPresent(a.b.UVKind)&&(s.push(a.b.UVKind),i.push("#define UV1")),r.isVerticesDataPresent(a.b.UV2Kind)&&1===u.coordinatesIndex&&(s.push(a.b.UV2Kind),i.push("#define UV2")))}var c=new _.a;if(r.useBones&&r.computeBonesUsingShaders&&r.skeleton){s.push(a.b.MatricesIndicesKind),s.push(a.b.MatricesWeightsKind),r.numBoneInfluencers>4&&(s.push(a.b.MatricesIndicesExtraKind),s.push(a.b.MatricesWeightsExtraKind));var d=r.skeleton;i.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers),r.numBoneInfluencers>0&&c.addCPUSkinningFallback(0,r),d.isUsingTextureForMatrices?i.push("#define BONETEXTURE"):i.push("#define BonesPerMesh "+(d.bones.length+1))}else i.push("#define NUM_BONE_INFLUENCERS 0");var l=r.morphTargetManager,p=0;l&&l.numInfluencers>0&&(i.push("#define MORPHTARGETS"),p=l.numInfluencers,i.push("#define NUM_MORPH_INFLUENCERS "+p),h.a.PrepareAttributesForMorphTargetsInfluencers(s,r,p));var f=this._scene;if(f.clipPlane&&i.push("#define CLIPPLANE"),f.clipPlane2&&i.push("#define CLIPPLANE2"),f.clipPlane3&&i.push("#define CLIPPLANE3"),f.clipPlane4&&i.push("#define CLIPPLANE4"),f.clipPlane5&&i.push("#define CLIPPLANE5"),f.clipPlane6&&i.push("#define CLIPPLANE6"),t&&(i.push("#define INSTANCES"),h.a.PushAttributesForInstances(s)),this.customShaderOptions&&this.customShaderOptions.defines)for(var m=0,g=this.customShaderOptions.defines;m<g.length;m++){var M=g[m];-1===i.indexOf(M)&&i.push(M)}this._light.needCube()&&i.push("#define USEDISTANCE"),this._isReadyCustomDefines(i,e,t);var S=i.join("\n");if(this._cachedDefines!==S){this._cachedDefines=S;var b="shadowMap",y=["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences","boneTextureWidth","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6"],w=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(b=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var E=0,I=this.customShaderOptions.attributes;E<I.length;E++){var L=I[E];-1===s.indexOf(L)&&s.push(L)}if(this.customShaderOptions.uniforms)for(var C=0,P=this.customShaderOptions.uniforms;C<P.length;C++){var x=P[C];-1===y.indexOf(x)&&y.push(x)}if(this.customShaderOptions.samplers)for(var T=0,O=this.customShaderOptions.samplers;T<O.length;T++){var A=O[T];-1===w.indexOf(A)&&w.push(A)}}this._effect=this._scene.getEngine().createEffect(b,s,y,w,S,c,void 0,void 0,{maxSimultaneousMorphTargets:p})}return!!this._effect.isReady()&&((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())))},e.prototype.prepareDefines=function(t,i){var s=this._scene,r=this._light;s.shadowsEnabled&&r.shadowEnabled&&(t["SHADOW"+i]=!0,this.useContactHardeningShadow?(t["SHADOWPCSS"+i]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePercentageCloserFiltering?(t["SHADOWPCF"+i]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+i]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+i]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+i]=!0),r.needCube()&&(t["SHADOWCUBE"+i]=!0))},e.prototype.bindShadowLight=function(t,i){var s=this._light,r=this._scene;if(r.shadowsEnabled&&s.shadowEnabled){var n=r.activeCamera;if(n){var a=this.getShadowMap();a&&(s.needCube()||i.setMatrix("lightMatrix"+t,this.getTransformMatrix()),this._filter===e.FILTER_PCF?(i.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),a.getSize().width,1/a.getSize().width,this.frustumEdgeFalloff,t)):this._filter===e.FILTER_PCSS?(i.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),i.setTexture("depthSampler"+t,this.getShadowMapForRendering()),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/a.getSize().width,this._contactHardeningLightSizeUVRatio*a.getSize().width,this.frustumEdgeFalloff,t)):(i.setTexture("shadowSampler"+t,this.getShadowMapForRendering()),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/a.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),s._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(n),this.getLight().getDepthMinZ(n)+this.getLight().getDepthMaxZ(n),t))}}},e.prototype.getTransformMatrix=function(){var e=this._scene;if(this._currentRenderID===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),r.e.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(r.e.Dot(this._lightDirection,r.e.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),r.a.LookAtLHToRef(t,t.add(this._lightDirection),r.e.Up(),this._viewMatrix);var i=this.getShadowMap();if(i){var s=i.renderList;s&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,s)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},e.prototype.recreateShadowMap=function(){var e=this._shadowMap;if(e){var t=e.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=t}},e.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},e.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},e.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty()),this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()},e.prototype.serialize=function(){var e={},t=this.getShadowMap();if(!t)return e;if(e.className=this.getClassName(),e.lightId=this._light.id,e.mapSize=t.getRenderSize(),e.forceBackFacesOnly=this.forceBackFacesOnly,e.darkness=this.getDarkness(),e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.filteringQuality=this.filteringQuality,e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.depthScale=this.depthScale,e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.renderList=[],t.renderList)for(var i=0;i<t.renderList.length;i++){var s=t.renderList[i];e.renderList.push(s.id)}return e},e.Parse=function(t,i,s){for(var r=i.getLightByID(t.lightId),n=s?s(t.mapSize,r):new e(t.mapSize,r),a=n.getShadowMap(),o=0;o<t.renderList.length;o++){i.getMeshesByID(t.renderList[o]).forEach((function(e){a&&(a.renderList||(a.renderList=[]),a.renderList.push(e))}))}return n.forceBackFacesOnly=!!t.forceBackFacesOnly,void 0!==t.darkness&&n.setDarkness(t.darkness),t.transparencyShadow&&n.setTransparencyShadow(!0),void 0!==t.frustumEdgeFalloff&&(n.frustumEdgeFalloff=t.frustumEdgeFalloff),void 0!==t.bias&&(n.bias=t.bias),void 0!==t.normalBias&&(n.normalBias=t.normalBias),t.usePercentageCloserFiltering?n.usePercentageCloserFiltering=!0:t.useContactHardeningShadow?n.useContactHardeningShadow=!0:t.usePoissonSampling?n.usePoissonSampling=!0:t.useExponentialShadowMap?n.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?n.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?n.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?n.useBlurCloseExponentialShadowMap=!0:t.useVarianceShadowMap?n.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(n.useBlurExponentialShadowMap=!0),void 0!==t.contactHardeningLightSizeUVRatio&&(n.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio),void 0!==t.filteringQuality&&(n.filteringQuality=t.filteringQuality),t.depthScale&&(n.depthScale=t.depthScale),t.blurScale&&(n.blurScale=t.blurScale),t.blurBoxOffset&&(n.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(n.useKernelBlur=t.useKernelBlur),t.blurKernel&&(n.blurKernel=t.blurKernel),n},e.CLASSNAME="ShadowGenerator",e.FILTER_NONE=0,e.FILTER_EXPONENTIALSHADOWMAP=1,e.FILTER_POISSONSAMPLING=2,e.FILTER_BLUREXPONENTIALSHADOWMAP=3,e.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.FILTER_PCF=6,e.FILTER_PCSS=7,e.QUALITY_HIGH=0,e.QUALITY_MEDIUM=1,e.QUALITY_LOW=2,e._SceneComponentInitialization=function(e){throw f.a.WarnImport("ShadowGeneratorSceneComponent")},e}()},lFBE:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var s=i("mrSG"),r=i("ADVu"),n=i("/SR9"),a=i("Ufda"),o=i("llUH"),h=i("fqU1");a.a.AddNodeConstructor("Light_Type_1",(function(e,t){return function(){return new u(e,n.e.Zero(),t)}}));var u=function(e){function t(t,i,s){var r=e.call(this,t,s)||this;return r._shadowFrustumSize=0,r._shadowOrthoScale=.1,r.autoUpdateExtends=!0,r.autoCalcShadowZBounds=!1,r._orthoLeft=Number.MAX_VALUE,r._orthoRight=Number.MIN_VALUE,r._orthoTop=Number.MIN_VALUE,r._orthoBottom=Number.MAX_VALUE,r.position=i.scale(-1),r.direction=i,r}return Object(s.c)(t,e),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return o.a.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,i)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(e){var t=this.getScene().activeCamera;t&&n.a.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(e,t,i){var s=this.getScene().activeCamera;if(s){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var r=n.e.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var a=Number.MAX_VALUE,o=Number.MIN_VALUE,h=0;h<i.length;h++){var u=i[h];if(u)for(var c=u.getBoundingInfo().boundingBox,d=0;d<c.vectorsWorld.length;d++)n.e.TransformCoordinatesToRef(c.vectorsWorld[d],t,r),r.x<this._orthoLeft&&(this._orthoLeft=r.x),r.y<this._orthoBottom&&(this._orthoBottom=r.y),r.x>this._orthoRight&&(this._orthoRight=r.x),r.y>this._orthoTop&&(this._orthoTop=r.y),this.autoCalcShadowZBounds&&(r.z<a&&(a=r.z),r.z>o&&(o=r.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=a,this._shadowMaxZ=o)}var l=this._orthoRight-this._orthoLeft,p=this._orthoTop-this._orthoBottom;n.a.OrthoOffCenterLHToRef(this._orthoLeft-l*this.shadowOrthoScale,this._orthoRight+l*this.shadowOrthoScale,this._orthoBottom-p*this.shadowOrthoScale,this._orthoTop+p*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:s.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:s.maxZ,e)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)},t.prototype.transferToNodeMaterialEffect=function(e,t){return this.computeTransformedInformation()?(e.setFloat3(t,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(t,this.direction.x,this.direction.y,this.direction.z),this)},t.prototype.getDepthMinZ=function(e){return 1},t.prototype.getDepthMaxZ=function(e){return 1},t.prototype.prepareLightSpecificDefines=function(e,t){e["DIRLIGHT"+t]=!0},Object(s.b)([Object(r.c)()],t.prototype,"shadowFrustumSize",null),Object(s.b)([Object(r.c)()],t.prototype,"shadowOrthoScale",null),Object(s.b)([Object(r.c)()],t.prototype,"autoUpdateExtends",void 0),Object(s.b)([Object(r.c)()],t.prototype,"autoCalcShadowZBounds",void 0),t}(h.a)},llUH:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i("mrSG"),r=i("ADVu"),n=i("/SR9"),a=i("Xeau"),o=i("Ufda"),h=i("Qmvu"),u=i("WHS4"),c=function(e){function t(i,s){var r=e.call(this,i,s)||this;return r.diffuse=new a.a(1,1,1),r.specular=new a.a(1,1,1),r.falloffType=t.FALLOFF_DEFAULT,r.intensity=1,r._range=Number.MAX_VALUE,r._inverseSquaredRange=0,r._photometricScale=1,r._intensityMode=t.INTENSITYMODE_AUTOMATIC,r._radius=1e-5,r.renderPriority=0,r._shadowEnabled=!0,r._excludeWithLayerMask=0,r._includeOnlyWithLayerMask=0,r._lightmapMode=0,r._excludedMeshesIds=new Array,r._includedOnlyMeshesIds=new Array,r._isLight=!0,r.getScene().addLight(r),r._uniformBuffer=new h.a(r.getScene().getEngine()),r._buildUniformLayout(),r.includedOnlyMeshes=new Array,r.excludedMeshes=new Array,r._resyncMeshes(),r}return Object(s.c)(t,e),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),t.prototype.transferTexturesToEffect=function(e,t){return this},t.prototype._bindLight=function(e,t,i,s,r){void 0===r&&(r=!1);var n=e.toString(),o=!1;if(!r||!this._uniformBuffer._alreadyBound){if(this._uniformBuffer.bindToEffect(i,"Light"+n),this._renderId!==t.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId();var h=this.getScaledIntensity();this.transferToEffect(i,n),this.diffuse.scaleToRef(h,a.c.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",a.c.Color3[0],this.range,n),s&&(this.specular.scaleToRef(h,a.c.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",a.c.Color3[1],this.radius,n)),o=!0}if(this.transferTexturesToEffect(i,n),t.shadowsEnabled&&this.shadowEnabled){var u=this.getShadowGenerator();u&&(u.bindShadowLight(n,i),o=!0)}o&&this._uniformBuffer.update()}},t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},t.prototype._syncParentEnabledState=function(){e.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return n.e.Zero()},t.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},t.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},t.prototype.dispose=function(t,i){void 0===i&&(i=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var s=0,r=this.getScene().meshes;s<r.length;s++){r[s]._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),e.prototype.dispose.call(this,t,i)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(e){var i=t.GetConstructorFromName(this.getTypeID(),e,this.getScene());return i?r.a.Clone(i,this):null},t.prototype.serialize=function(){var e=r.a.Serialize(this);return e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.id),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((function(t){e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(t){e.includedOnlyMeshesIds.push(t.id)}))),r.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.GetConstructorFromName=function(e,t,i){var s=o.a.Construct("Light_Type_"+e,t,i);return s||null},t.Parse=function(e,i){var s=t.GetConstructorFromName(e.type,e.name,i);if(!s)return null;var n=r.a.Parse(s,e,i);if(e.excludedMeshesIds&&(n._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(n._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.falloffType&&(n.falloffType=e.falloffType),void 0!==e.lightmapMode&&(n.lightmapMode=e.lightmapMode),e.animations){for(var a=0;a<e.animations.length;a++){var h=e.animations[a],c=u.a.GetClass("BABYLON.Animation");c&&n.animations.push(c.Parse(h))}o.a.ParseAnimationRanges(n,e,i)}return e.autoAnimate&&i.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),n},t.prototype._hookArrayForExcluded=function(e){var t=this,i=e.push;e.push=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];for(var n=i.apply(e,s),a=0,o=s;a<o.length;a++){var h=o[a];h._resyncLightSource(t)}return n};var s=e.splice;e.splice=function(i,r){for(var n=s.apply(e,[i,r]),a=0,o=n;a<o.length;a++){o[a]._resyncLightSource(t)}return n};for(var r=0,n=e;r<n.length;r++){n[r]._resyncLightSource(this)}},t.prototype._hookArrayForIncludedOnly=function(e){var t=this,i=e.push;e.push=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];var n=i.apply(e,s);return t._resyncMeshes(),n};var s=e.splice;e.splice=function(i,r){var n=s.apply(e,[i,r]);return t._resyncMeshes(),n},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){t[e]._resyncLightSource(this)}},t.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[e];-1!==i.lightSources.indexOf(this)&&i._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var e=0,i=this.getTypeID(),s=this.intensityMode;switch(s===t.INTENSITYMODE_AUTOMATIC&&(s=i===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),i){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(s){case t.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case t.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(s){case t.INTENSITYMODE_ILLUMINANCE:e=1;break;case t.INTENSITYMODE_LUMINANCE:var r=this.radius;r=Math.max(r,.001),e=2*Math.PI*(1-Math.cos(r))}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},t.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=0,t.FALLOFF_PHYSICAL=1,t.FALLOFF_GLTF=2,t.FALLOFF_STANDARD=3,t.LIGHTMAP_DEFAULT=0,t.LIGHTMAP_SPECULAR=1,t.LIGHTMAP_SHADOWSONLY=2,t.INTENSITYMODE_AUTOMATIC=0,t.INTENSITYMODE_LUMINOUSPOWER=1,t.INTENSITYMODE_LUMINOUSINTENSITY=2,t.INTENSITYMODE_ILLUMINANCE=3,t.INTENSITYMODE_LUMINANCE=4,t.LIGHTTYPEID_POINTLIGHT=0,t.LIGHTTYPEID_DIRECTIONALLIGHT=1,t.LIGHTTYPEID_SPOTLIGHT=2,t.LIGHTTYPEID_HEMISPHERICLIGHT=3,Object(s.b)([Object(r.e)()],t.prototype,"diffuse",void 0),Object(s.b)([Object(r.e)()],t.prototype,"specular",void 0),Object(s.b)([Object(r.c)()],t.prototype,"falloffType",void 0),Object(s.b)([Object(r.c)()],t.prototype,"intensity",void 0),Object(s.b)([Object(r.c)()],t.prototype,"range",null),Object(s.b)([Object(r.c)()],t.prototype,"intensityMode",null),Object(s.b)([Object(r.c)()],t.prototype,"radius",null),Object(s.b)([Object(r.c)()],t.prototype,"_renderPriority",void 0),Object(s.b)([Object(r.b)("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),Object(s.b)([Object(r.c)("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),Object(s.b)([Object(r.c)("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),Object(s.b)([Object(r.c)("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),Object(s.b)([Object(r.c)("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(o.a)},xnlA:function(e,t,i){"use strict";var s=i("itUE"),r=i("mrSG"),n=i("/SR9"),a=i("srWW"),o=(i("IS0N"),i("QcF5"),i("8uwT"),i("n5HA")),h=i("T5H4"),u=i("qAwy"),c=n.e.Up(),d=n.e.Zero(),l=new n.e,p=new n.e,f=new n.a,_=function(e){function t(t,i,s){var r=e.call(this,t,i,s)||this;if(1==r._scene.getEngine().webGLVersion)throw"CSM can only be used in WebGL2";return r.usePercentageCloserFiltering=!0,r}return Object(r.c)(t,e),t.prototype._validateFilter=function(e){return e===s.a.FILTER_NONE||e===s.a.FILTER_PCF||e===s.a.FILTER_PCSS?e:(console.error('Unsupported filter "'+e+'"!'),s.a.FILTER_NONE)},Object.defineProperty(t.prototype,"numCascades",{get:function(){return this._numCascades},set:function(e){(e=Math.min(Math.max(e,t.MIN_CASCADES_COUNT),t.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=e,this.recreateShadowMap())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"freezeShadowCastersBoundingInfo",{get:function(){return this._freezeShadowCastersBoundingInfo},set:function(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()},enumerable:!0,configurable:!0}),t.prototype._computeShadowCastersBoundingInfo=function(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._shadowMap&&this._shadowMap.renderList){for(var e=this._shadowMap.renderList,t=0;t<e.length;t++){if(r=e[t]){var i=r.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(i.minimumWorld),this._scbiMax.maximizeInPlace(i.maximumWorld)}}var s=this._scene.meshes;for(t=0;t<s.length;t++){var r;if((r=s[t])&&r.isVisible&&r.isEnabled&&r.receiveShadows){i=r.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(i.minimumWorld),this._scbiMax.maximizeInPlace(i.maximumWorld)}}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)},Object.defineProperty(t.prototype,"shadowCastersBoundingInfo",{get:function(){return this._shadowCastersBoundingInfo},set:function(e){this._shadowCastersBoundingInfo=e},enumerable:!0,configurable:!0}),t.prototype.setMinMaxDistance=function(e,t){this._minDistance===e&&this._maxDistance===t||(e>t&&(e=0,t=1),e<0&&(e=0),t>1&&(t=1),this._minDistance=e,this._maxDistance=t,this._breaksAreDirty=!0)},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return t.CLASSNAME},t.prototype.getCascadeMinExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null},t.prototype.getCascadeMaxExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null},Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._scene&&this._scene.activeCamera?this._shadowMaxZ:0},set:function(e){this._scene&&this._scene.activeCamera?this._shadowMaxZ===e||e<this._scene.activeCamera.minZ||e>this._scene.activeCamera.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this._light._markMeshesAsLightDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthClamp",{get:function(){return this._depthClamp},set:function(e){this._depthClamp=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cascadeBlendPercentage",{get:function(){return this._cascadeBlendPercentage},set:function(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lambda",{get:function(){return this._lambda},set:function(e){var t=Math.min(Math.max(e,0),1);this._lambda!=t&&(this._lambda=t,this._breaksAreDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.getCascadeViewMatrix=function(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null},t.prototype.getCascadeProjectionMatrix=function(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null},t.prototype.getCascadeTransformMatrix=function(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null},t.prototype.setDepthRenderer=function(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)},Object.defineProperty(t.prototype,"autoCalcDepthBounds",{get:function(){return this._autoCalcDepthBounds},set:function(e){var t=this,i=this._scene.activeCamera;if(i){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new u.a(i),this._depthReducer.onAfterReductionPerformed.add((function(e){var i=e.min,s=e.max;i>=s&&(i=0,s=1),i==t._minDistance&&s==t._maxDistance||t.setMinMaxDistance(i,s)})),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoCalcDepthBoundsRefreshRate",{get:function(){var e,t,i;return null!=(i=null===(t=null===(e=this._depthReducer)||void 0===e?void 0:e.depthRenderer)||void 0===t?void 0:t.getDepthMap().refreshRate)?i:-1},set:function(e){var t;(null===(t=this._depthReducer)||void 0===t?void 0:t.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)},enumerable:!0,configurable:!0}),t.prototype.splitFrustum=function(){this._breaksAreDirty=!0},t.prototype._splitFrustum=function(){var e=this._scene.activeCamera;if(e){for(var t=e.minZ,i=e.maxZ,s=i-t,r=this._minDistance,n=t+r*s,a=t+(this._shadowMaxZ<i&&this._shadowMaxZ>=t?Math.min((this._shadowMaxZ-t)/(i-t),this._maxDistance):this._maxDistance)*s,o=a-n,h=a/n,u=0;u<this._cascades.length;++u){var c=(u+1)/this._numCascades,d=n*Math.pow(h,c),l=n+o*c,p=this._lambda*(d-l)+l;this._cascades[u].prevBreakDistance=0===u?r:this._cascades[u-1].breakDistance,this._cascades[u].breakDistance=(p-t)/s,this._viewSpaceFrustumsZ[u]=t+this._cascades[u].breakDistance*s,this._frustumLengths[u]=(this._cascades[u].breakDistance-this._cascades[u].prevBreakDistance)*s}this._breaksAreDirty=!1}},t.prototype._computeMatrices=function(){if(this._scene.activeCamera){n.e.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(n.e.Dot(this._lightDirection,n.e.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);for(var e=0;e<this._numCascades;++e){this._computeFrustumInWorldSpace(e),this._computeCascadeFrustum(e),this._cascadeMaxExtents[e].subtractToRef(this._cascadeMinExtents[e],l),this._frustumCenter[e].addToRef(this._lightDirection.scale(this._cascadeMinExtents[e].z),this._shadowCameraPos[e]),n.a.LookAtLHToRef(this._shadowCameraPos[e],this._frustumCenter[e],c,this._viewMatrices[e]);var t=0,i=l.z,r=this._shadowCastersBoundingInfo;r.update(this._viewMatrices[e]),i=Math.min(i,r.boundingBox.maximumWorld.z),t=this._depthClamp&&this.filter!==s.a.FILTER_PCSS?Math.max(t,r.boundingBox.minimumWorld.z):Math.min(t,r.boundingBox.minimumWorld.z),n.a.OrthoOffCenterLHToRef(this._cascadeMinExtents[e].x,this._cascadeMaxExtents[e].x,this._cascadeMinExtents[e].y,this._cascadeMaxExtents[e].y,t,i,this._projectionMatrices[e]),this._cascadeMinExtents[e].z=t,this._cascadeMaxExtents[e].z=i,this._viewMatrices[e].multiplyToRef(this._projectionMatrices[e],this._transformMatrices[e]),n.e.TransformCoordinatesToRef(d,this._transformMatrices[e],l),l.scaleInPlace(this._mapSize/2),p.copyFromFloats(Math.round(l.x),Math.round(l.y),Math.round(l.z)),p.subtractInPlace(l).scaleInPlace(2/this._mapSize),n.a.TranslationToRef(p.x,p.y,0,f),this._projectionMatrices[e].multiplyToRef(f,this._projectionMatrices[e]),this._viewMatrices[e].multiplyToRef(this._projectionMatrices[e],this._transformMatrices[e]),this._transformMatrices[e].copyToArray(this._transformMatricesAsArray,16*e)}}},t.prototype._computeFrustumInWorldSpace=function(e){if(this._scene.activeCamera){var i=this._cascades[e].prevBreakDistance,s=this._cascades[e].breakDistance;this._scene.activeCamera.getViewMatrix();for(var r=n.a.Invert(this._scene.activeCamera.getTransformationMatrix()),a=0;a<t.frustumCornersNDCSpace.length;++a)n.e.TransformCoordinatesToRef(t.frustumCornersNDCSpace[a],r,this._frustumCornersWorldSpace[e][a]);for(a=0;a<t.frustumCornersNDCSpace.length/2;++a)l.copyFrom(this._frustumCornersWorldSpace[e][a+4]).subtractInPlace(this._frustumCornersWorldSpace[e][a]),p.copyFrom(l).scaleInPlace(i),l.scaleInPlace(s),l.addInPlace(this._frustumCornersWorldSpace[e][a]),this._frustumCornersWorldSpace[e][a+4].copyFrom(l),this._frustumCornersWorldSpace[e][a].addInPlace(p)}},t.prototype._computeCascadeFrustum=function(e){if(this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0),this._scene.activeCamera){for(var t=0;t<this._frustumCornersWorldSpace[e].length;++t)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][t]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){var i=0;for(t=0;t<this._frustumCornersWorldSpace[e].length;++t){var s=this._frustumCornersWorldSpace[e][t].subtractToRef(this._frustumCenter[e],l).length();i=Math.max(i,s)}i=Math.ceil(16*i)/16,this._cascadeMaxExtents[e].copyFromFloats(i,i,i),this._cascadeMinExtents[e].copyFromFloats(-i,-i,-i)}else{var r=this._frustumCenter[e];this._frustumCenter[e].addToRef(this._lightDirection,l),n.a.LookAtLHToRef(r,l,c,f);for(t=0;t<this._frustumCornersWorldSpace[e].length;++t)n.e.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][t],f,l),this._cascadeMinExtents[e].minimizeInPlace(l),this._cascadeMaxExtents[e].maximizeInPlace(l)}}},t.prototype._initializeGenerator=function(){var i,s,r,a,o,u,c,d,l,p,f,_,m,g,M,S,b,y,w,E;this.penumbraDarkness=null!=(i=this.penumbraDarkness)?i:1,this._numCascades=null!=(s=this._numCascades)?s:t.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=null!=(r=this.stabilizeCascades)&&r,this._freezeShadowCastersBoundingInfoObservable=null!=(a=this._freezeShadowCastersBoundingInfoObservable)?a:null,this.freezeShadowCastersBoundingInfo=null!=(o=this.freezeShadowCastersBoundingInfo)&&o,this._scbiMin=null!=(u=this._scbiMin)?u:new n.e(0,0,0),this._scbiMax=null!=(c=this._scbiMax)?c:new n.e(0,0,0),this._shadowCastersBoundingInfo=null!=(d=this._shadowCastersBoundingInfo)?d:new h.a(new n.e(0,0,0),new n.e(0,0,0)),this._breaksAreDirty=null==(l=this._breaksAreDirty)||l,this._minDistance=null!=(p=this._minDistance)?p:0,this._maxDistance=null!=(f=this._maxDistance)?f:1,this._currentLayer=null!=(_=this._currentLayer)?_:0,this._shadowMaxZ=null!=(M=null!=(m=this._shadowMaxZ)?m:null===(g=this._scene.activeCamera)||void 0===g?void 0:g.maxZ)?M:1e4,this._debug=null!=(S=this._debug)&&S,this._depthClamp=null==(b=this._depthClamp)||b,this._cascadeBlendPercentage=null!=(y=this._cascadeBlendPercentage)?y:.1,this._lambda=null!=(w=this._lambda)?w:.5,this._autoCalcDepthBounds=null!=(E=this._autoCalcDepthBounds)&&E,e.prototype._initializeGenerator.call(this)},t.prototype._createTargetRenderTexture=function(){var e={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new a.a(this._light.name+"_shadowMap",e,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0),this._shadowMap.createDepthStencilTexture(513,!0)},t.prototype._initializeShadowMap=function(){var i=this;if(e.prototype._initializeShadowMap.call(this),null!==this._shadowMap){this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(var s=0;s<this._numCascades;++s){this._cascades[s]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[s]=n.a.Zero(),this._projectionMatrices[s]=n.a.Zero(),this._transformMatrices[s]=n.a.Zero(),this._cascadeMinExtents[s]=new n.e,this._cascadeMaxExtents[s]=new n.e,this._frustumCenter[s]=new n.e,this._shadowCameraPos[s]=new n.e,this._frustumCornersWorldSpace[s]=new Array(t.frustumCornersNDCSpace.length);for(var r=0;r<t.frustumCornersNDCSpace.length;++r)this._frustumCornersWorldSpace[s][r]=new n.e}this._shadowMap.onBeforeRenderObservable.add((function(e){i._currentLayer=e})),this._shadowMap.onBeforeBindObservable.add((function(){i._breaksAreDirty&&i._splitFrustum(),i._computeMatrices()})),this._splitFrustum()}},t.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(e,t){t.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))},t.prototype._isReadyCustomDefines=function(e,t,i){this._depthClamp&&this._filter!==s.a.FILTER_PCSS&&e.push("#define DEPTHCLAMP")},t.prototype.prepareDefines=function(t,i){e.prototype.prepareDefines.call(this,t,i);var s=this._scene,r=this._light;if(s.shadowsEnabled&&r.shadowEnabled){t["SHADOWCSM"+i]=!0,t["SHADOWCSMDEBUG"+i]=this.debug,t["SHADOWCSMNUM_CASCADES"+i]=this.numCascades,t["SHADOWCSM_RIGHTHANDED"+i]=s.useRightHandedSystem;var n=s.activeCamera;n&&this._shadowMaxZ<n.maxZ&&(t["SHADOWCSMUSESHADOWMAXZ"+i]=!0),0===this.cascadeBlendPercentage&&(t["SHADOWCSMNOBLEND"+i]=!0)}},t.prototype.bindShadowLight=function(e,t){var i=this._light,r=this._scene;if(r.shadowsEnabled&&i.shadowEnabled){var n=r.activeCamera;if(n){var a=this.getShadowMap();if(a){var o=a.getSize().width;if(t.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),t.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),t.setFloat("cascadeBlendFactor"+e,0===this.cascadeBlendPercentage?1e4:1/this.cascadeBlendPercentage),t.setArray("frustumLengths"+e,this._frustumLengths),this._filter===s.a.FILTER_PCF)t.setDepthStencilTexture("shadowSampler"+e,a),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),o,1/o,this.frustumEdgeFalloff,e);else if(this._filter===s.a.FILTER_PCSS){for(var h=0;h<this._numCascades;++h)this._lightSizeUVCorrection[2*h+0]=0===h?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[h].x-this._cascadeMinExtents[h].x),this._lightSizeUVCorrection[2*h+1]=0===h?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[h].y-this._cascadeMinExtents[h].y),this._depthCorrection[h]=0===h?1:(this._cascadeMaxExtents[h].z-this._cascadeMinExtents[h].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);t.setDepthStencilTexture("shadowSampler"+e,a),t.setTexture("depthSampler"+e,a),t.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),t.setArray("depthCorrection"+e,this._depthCorrection),t.setFloat("penumbraDarkness"+e,this.penumbraDarkness),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/o,this._contactHardeningLightSizeUVRatio*o,this.frustumEdgeFalloff,e)}else t.setTexture("shadowSampler"+e,a),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),o,1/o,this.frustumEdgeFalloff,e);i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(n),this.getLight().getDepthMinZ(n)+this.getLight().getDepthMaxZ(n),e)}}}},t.prototype.getTransformMatrix=function(){return this.getCascadeTransformMatrix(0)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this),i=this.getShadowMap();if(!i)return t;if(t.numCascades=this._numCascades,t.debug=this._debug,t.stabilizeCascades=this.stabilizeCascades,t.lambda=this._lambda,t.cascadeBlendPercentage=this.cascadeBlendPercentage,t.depthClamp=this._depthClamp,t.autoCalcDepthBounds=this.autoCalcDepthBounds,t.shadowMaxZ=this._shadowMaxZ,t.penumbraDarkness=this.penumbraDarkness,t.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,t.minDistance=this.minDistance,t.maxDistance=this.maxDistance,t.renderList=[],i.renderList)for(var s=0;s<i.renderList.length;s++){var r=i.renderList[s];t.renderList.push(r.id)}return t},t.Parse=function(e,i){var r=s.a.Parse(e,i,(function(e,i){return new t(e,i)}));return void 0!==e.numCascades&&(r.numCascades=e.numCascades),void 0!==e.debug&&(r.debug=e.debug),void 0!==e.stabilizeCascades&&(r.stabilizeCascades=e.stabilizeCascades),void 0!==e.lambda&&(r.lambda=e.lambda),void 0!==e.cascadeBlendPercentage&&(r.cascadeBlendPercentage=e.cascadeBlendPercentage),void 0!==e.depthClamp&&(r.depthClamp=e.depthClamp),void 0!==e.autoCalcDepthBounds&&(r.autoCalcDepthBounds=e.autoCalcDepthBounds),void 0!==e.shadowMaxZ&&(r.shadowMaxZ=e.shadowMaxZ),void 0!==e.penumbraDarkness&&(r.penumbraDarkness=e.penumbraDarkness),void 0!==e.freezeShadowCastersBoundingInfo&&(r.freezeShadowCastersBoundingInfo=e.freezeShadowCastersBoundingInfo),void 0!==e.minDistance&&void 0!==e.maxDistance&&r.setMinMaxDistance(e.minDistance,e.maxDistance),r},t.frustumCornersNDCSpace=[new n.e(-1,1,-1),new n.e(1,1,-1),new n.e(1,-1,-1),new n.e(-1,-1,-1),new n.e(-1,1,1),new n.e(1,1,1),new n.e(1,-1,1),new n.e(-1,-1,1)],t.CLASSNAME="CascadedShadowGenerator",t.DEFAULT_CASCADES_COUNT=4,t.MIN_CASCADES_COUNT=2,t.MAX_CASCADES_COUNT=4,t._SceneComponentInitialization=function(e){throw o.a.WarnImport("ShadowGeneratorSceneComponent")},t}(s.a),m=i("Yap0");i("KbzI").a.AddParser(m.a.NAME_SHADOWGENERATOR,(function(e,t){if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(var i=0,r=e.shadowGenerators.length;i<r;i++){var n=e.shadowGenerators[i];n.className===_.CLASSNAME?_.Parse(n,t):s.a.Parse(n,t)}}));var g=function(){function e(e){this.name=m.a.NAME_SHADOWGENERATOR,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(m.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(e){e.shadowGenerators=[];for(var t=0,i=this.scene.lights;t<i.length;t++){var s=i[t].getShadowGenerator();s&&e.shadowGenerators.push(s.serialize())}},e.prototype.addFromContainer=function(e){},e.prototype.removeFromContainer=function(e,t){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(e){var t=this.scene;if(this.scene.shadowsEnabled)for(var i=0;i<t.lights.length;i++){var s=t.lights[i],r=s.getShadowGenerator();if(s.isEnabled()&&s.shadowEnabled&&r){var n=r.getShadowMap();-1!==t.textures.indexOf(n)&&e.push(n)}}},e}();s.a._SceneComponentInitialization=function(e){var t=e._getComponent(m.a.NAME_SHADOWGENERATOR);t||(t=new g(e),e._addComponent(t))}},zZL8:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var s=i("mrSG"),r=i("ADVu"),n=i("/SR9"),a=i("Ufda"),o=i("llUH"),h=i("fqU1");a.a.AddNodeConstructor("Light_Type_0",(function(e,t){return function(){return new u(e,n.e.Zero(),t)}}));var u=function(e){function t(t,i,s){var r=e.call(this,t,s)||this;return r._shadowAngle=Math.PI/2,r.position=i,r}return Object(s.c)(t,e),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return o.a.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(t){if(this.direction)return e.prototype.getShadowDirection.call(this,t);switch(t){case 0:return new n.e(1,0,0);case 1:return new n.e(-1,0,0);case 2:return new n.e(0,-1,0);case 3:return new n.e(0,1,0);case 4:return new n.e(0,0,1);case 5:return new n.e(0,0,-1)}return n.e.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,i){var s=this.getScene().activeCamera;s&&n.a.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(s),this.getDepthMaxZ(s),e)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this},t.prototype.transferToNodeMaterialEffect=function(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(t,this.position.x,this.position.y,this.position.z),this},t.prototype.prepareLightSpecificDefines=function(e,t){e["POINTLIGHT"+t]=!0},Object(s.b)([Object(r.c)()],t.prototype,"shadowAngle",null),t}(h.a)}}]);